<div class="dashboard-wrapper">
  <aside class="sidebar">
    <div class="brand">
      <img src="assets/images/egyszeru-logo.png" alt="M" class="logo-img">
      <span class="brand-name">MentorMeet</span>
    </div>

    <nav class="nav-menu">
      <a routerLink="/user-list" routerLinkActive="active" class="nav-item">
        <img src="assets/images/icons/searchsvg.svg" class="nav-svg" alt="Search">
        <span>Keresés</span>
      </a>

      <a [routerLink]="currentUser?.szerep === 'tanar' ? '/teacher-dashboard' : '/student-dashboard'"
        routerLinkActive="active" class="nav-item">
        <img src="assets/images/icons/profilesvg.svg" class="nav-svg" alt="Profile">
        <span>Profil</span>
      </a>

      <a routerLink="/chat" routerLinkActive="active" class="nav-item">
        <img src="assets/images/icons/chatsvg.svg" class="nav-svg" alt="Chat">
        <span>Chat</span>
      </a>

      <a routerLink="/friends" routerLinkActive="active" class="nav-item">
        <img src="assets/images/icons/friendssvg.svg" class="nav-svg" alt="Friends">
        <span>Ismerősök</span>
      </a>
    </nav>



    <div class="nav-user-info" *ngIf="currentUser">
      <img src="assets/images/profilkep_placeholder.jpg" class="nav-avatar">
      <div class="text-info">
        <p class="nav-name">{{ currentUser.nev }}</p>
        <p class="nav-role">{{ currentUser.szerep === 'diak' ? 'Tanuló' : 'Oktató' }}</p>
      </div>
    </div>
  </aside>

  <main class="content-area">
    <header class="content-header">
      <div class="header-left">
        <h1>{{ currentUser?.szerep === 'tanar' ? 'Profil szerkesztése' : 'Tanulói Portál' }}</h1>
      </div>

      <div class="header-right">
        <div class="notification-container">
          <button class="icon-btn" (click)="toggleNotifications($event)">
            <img src="assets/images/icons/notificationsvg.svg" alt="Notifications" class="header-svg">
            <span class="badge" *ngIf="pendingRequests.length">{{ pendingRequests.length }}</span>
          </button>

          <div class="notif-dropdown" *ngIf="isNotificationOpen">
            <div class="dropdown-header">
              <h3>Értesítések</h3>
            </div>
            <div class="notif-scroll-area">
              <div *ngFor="let req of pendingRequests" class="notif-item">
                <img src="assets/images/profilkep_placeholder.jpg" class="item-avatar">
                <div class="item-content">
                  <p>
                    <strong>{{ req.nev || req.tanar_neve }}</strong>
                    {{ currentUser?.szerep === 'tanar' ? 'kapcsolódni szeretne' : 'elfogadta a kérésedet' }}
                  </p>

                  <div class="item-actions" *ngIf="currentUser?.szerep === 'tanar'">
                    <button (click)="handleRequest(req.request_id, 'accepted')" class="confirm-btn">Elfogadás</button>
                    <button (click)="handleRequest(req.request_id, 'rejected')" class="remove-btn">Elutasítás</button>
                  </div>
                </div>
              </div>
              <div *ngIf="pendingRequests.length === 0" class="empty-notif">Nincs új értesítés.</div>
            </div>
          </div>
        </div>

        <div class="settings-menu-container">
          <button class="icon-btn" (click)="toggleSettingsMenu($event)">
            <img src="assets/images/icons/settingssvg.svg" alt="Settings" class="header-svg">
          </button>

          <div class="settings-dropdown" *ngIf="isSettingsMenuOpen">
            <div class="dropdown-item" (click)="goToProfileEdit()">
              <img src="assets/images/icons/privacysett.svg" class="dropdown-svg">
              <span>Beállítások és adatvédelem</span>
            </div>

            <div class="dropdown-item" (click)="toggleDarkMode()">
              <img [src]="isDarkMode ? 'assets/images/icons/sun.svg' : 'assets/images/icons/moon.svg'"
                class="dropdown-svg">
              <span>{{ isDarkMode ? 'Világos mód' : 'Sötét mód' }}</span>
            </div>

            <div class="dropdown-divider"></div>

            <div class="dropdown-item logout-item" (click)="logout()">
              <img src="assets/images/icons/logout.svg" class="dropdown-svg logout-svg">
              <span>Kijelentkezés</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="scroll-content">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>